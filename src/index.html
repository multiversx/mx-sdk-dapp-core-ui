<!doctype html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" />
    <title>Stencil Component Starter</title>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" />
    <script type="module" src="/build/sdk-dapp-core-ui.esm.js"></script>
    <script nomodule src="/build/sdk-dapp-core-ui.js"></script>
  </head>
  <body>
    <my-component first="Stencil" middle="'Don't call me a framework'" last="JS"></my-component>
    <transaction-toast-list />
    <button id="sign-transactions-btn" onclick="openSignModal();">Open Sign Transactions Modal</button>
    <button id="ledger-connect-btn" onclick="openLedgerConnectModal();">Open Ledger Connect Modal</button>
    <button id="show-notification-btn" onclick="showNotification();">Show Notification</button>
    <script>
      function openSignModal() {
        const signTransactionsModal = document.querySelector('sign-transactions-modal');
        if (!signTransactionsModal) {
          const newModal = document.createElement('sign-transactions-modal');
          document.body.appendChild(newModal);
        }
      }

      function openLedgerConnectModal() {
        const ledgerConnectModal = document.querySelector('ledger-connect-modal');
        if (!ledgerConnectModal) {
          const newModal = document.createElement('ledger-connect-modal');
          document.body.appendChild(newModal);
        }
      }

      let notificationId = 0;

      function showNotification() {
        const toastData = {
          success: {
            id: notificationId,
            icon: 'check',
            hasCloseButton: true,
            title: 'Transaction successful',
            iconClassName: 'success',
          },
          pending: {
            id: notificationId,
            icon: 'hourglass',
            hasCloseButton: false,
            title: 'Processing transaction',
            iconClassName: 'warning',
          },
          fail: {
            id: notificationId,
            icon: 'times',
            title: 'Transaction failed',
            hasCloseButton: true,
            iconClassName: 'danger',
          },
          invalid: {
            id: notificationId,
            icon: 'ban',
            title: 'Transaction invalid',
            hasCloseButton: true,
            iconClassName: 'warning',
          },
          timedOut: {
            id: notificationId,
            icon: 'times',
            title: 'Transaction timed out',
            hasCloseButton: true,
            iconClassName: 'warning',
          },
        };

        const statuses = ['success', 'pending', 'fail', 'invalid', 'timedOut', 'pending', 'signed', 'sent', 'executed', 'notExecuted', 'rewardReverted'];
        const status = statuses[Math.floor(Math.random() * statuses.length)];
        const progressStatuses = ['pending', 'signed', 'sent', 'executed', 'notExecuted', 'rewardReverted'];

        const newToast = document.createElement('transaction-toast');
        newToast.status = status;
        newToast.toastDataState = progressStatuses.includes(status) ? toastData['pending'] : toastData[status];

        if (progressStatuses.includes(status)) {
          newToast.transactionProgressState = {
            currentRemaining: 100,
          };

          const intervalId = setInterval(() => {
            if (newToast.transactionProgressState.currentRemaining > 0) {
              newToast.transactionProgressState = {
                ...newToast.transactionProgressState,
                currentRemaining: newToast.transactionProgressState.currentRemaining - 1,
              };
            } else {
              clearInterval(intervalId);
            }
          }, 200);
        }

        newToast.processedTransactionsStatus = '0 / 1 transactions processed';
        newToast.toastId = notificationId.toString();
        newToast.transactions = [{ hash: 'erd1...8ctr', status: 'success' }];

        const transactionListElement = document.getElementById('transaction-list');
        if (transactionListElement) {
          transactionListElement.appendChild(newToast);
        }

        notificationId++;
      }
    </script>
  </body>
</html>
